{
  "$id": "https://eirenhall.com/schema/item_base.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Knowledge Item",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "id",
    "item_type",
    "title",
    "realm",
    "sensitivity",
    "capabilities",
    "fields",
    "metadata",
    "derived"
  ],
  "properties": {
    "id": {
      "$ref": "./fields/identifier.json"
    },
    "item_type": {
      "type": "string",
      "pattern": "^[a-z]+(?:_[a-z]+)*$"
    },
    "title": {
      "$ref": "./fields/title.json"
    },
    "realm": {
      "$ref": "./fields/realm_descriptor.json"
    },
    "sensitivity": {
      "$ref": "./fields/sensitivity_descriptor.json"
    },
    "capabilities": {
      "$ref": "./fields/capabilities.json"
    },
    "owner": {
      "$ref": "./fields/user_reference.json"
    },
    "created_at": {
      "$ref": "./fields/timestamp.json"
    },
    "updated_at": {
      "$ref": "./fields/timestamp.json"
    },
    "fields": {
      "type": "object",
      "propertyNames": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9_]*$"
      },
      "additionalProperties": {
        "oneOf": [
          {
            "type": "string"
          },
          {
            "type": "number"
          },
          {
            "type": "boolean"
          },
          {
            "$ref": "./fields/rich_text.json"
          },
          {
            "$ref": "./fields/tag_list.json"
          },
          {
            "$ref": "./fields/timestamp.json"
          },
          {
            "$ref": "./fields/user_reference.json"
          },
          {
            "$ref": "./fields/object_reference.json"
          },
          {
            "type": "array",
            "items": {
              "$ref": "./fields/checklist_item.json"
            }
          },
          {
            "type": "array",
            "items": {
              "$ref": "./fields/user_reference.json"
            },
            "minItems": 1
          },
          {
            "type": "array",
            "items": {
              "$ref": "./fields/object_reference.json"
            }
          },
          {
            "type": "array",
            "items": {
              "$ref": "./fields/link.json"
            }
          },
          {
            "$ref": "./fields/webcomic_availability.json"
          },
          {
            "$ref": "./fields/webcomic_status.json"
          },
          {
            "$ref": "./fields/webcomic_scraping_config.json"
          },
          {
            "type": "array",
            "items": {
              "$ref": "./fields/webcomic_artist.json"
            }
          }
        ]
      }
    },
    "metadata": {
      "type": "object",
      "propertyNames": {
        "type": "string",
        "pattern": "^(?:(?:sys|tmp)\\.[a-z0-9_.-]+|cap\\.[a-z0-9_]+(?:\\.[a-z0-9_]+)+|ext\\.[a-z0-9_-]+\\.[a-z0-9_.-]+)$"
      }
    },
    "derived": {
      "type": "object",
      "propertyNames": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9_]*$"
      },
      "additionalProperties": {
        "oneOf": [
          {
            "$ref": "./fields/progress_summary.json"
          },
          {
            "$ref": "./fields/timestamp.json"
          },
          {
            "type": "number"
          },
          {
            "type": "string"
          },
          {
            "type": "boolean"
          }
        ]
      }
    }
  }
}
